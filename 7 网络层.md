 

一、网络概述
------

### 1、 网络层的主要任务

*   就是将分组**从源主机经过多个网络和多段链路传输到目的主机**。
*   可以将该任务划分为**分组转发**和**路由选择**两种重要的功能。

### 2、网络层向上层提供两种服务

*   **面向连接的虚电路服务**
    
    *   核心思想是“**可靠通信应由网络自身来保证**”
    *   通信双方沿着**已建立的虚电路发送分组**  
        ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/6903c07514d4458a9cd74abe63ae5615.png)
*   **无连接的数据报服务**
    
    *   核心思想是“**可靠通信应由用户主机来保证**”。
    *   **不需要建立网络层连接**。
    *   **每个分组可走不同的路径**，因此，每个分组的首部都必须携带目的**主机的完整地址**。
    *   通信结束后，**没有需要释放的连接**。
    *   可能**误码、丢失、重复和失序** 。由于**网络自身不提供端到端的可靠传输服务**，这就使得网络中的路由器可以做得比较简单，大大降低了网络造价。  
        ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/58035af610474b708120f37201a5e929.png)

二、网络层协议
-------

1、[IPv4](https://so.csdn.net/so/search?q=IPv4&spm=1001.2101.3001.7020)数据报格式
---------------------------------------------------------------------------

*   在TCP/IP标准中，各种数据格式常常以32比特（即4字节）为单位来描述。
*   网络层**数据包（IP数据包）由首部、数据2部分组成**
    *   数据：很多时候是由**传输层传递下来的数据段**  
        ![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/47f5fc1555394048810161e491455fe2.png)

①：版本  
长度为4个比特，用来**表示IP协议的版本**。  
0b0100 : IPv4 、 0b0110 : [IPv6](https://so.csdn.net/so/search?q=IPv6&spm=1001.2101.3001.7020)  
②：首部长度  
占4个比特，**乘以4才是最终长度**，用来表示IPv4数据报的首部长度。

*   最小取值为二进制的0101，20字节
*   最大取值为二进制的1111，60字节。

③：区分服务  
它通过在 IPv4 数据包的头部字段中标记特定的值，来**区分不同数据流的优先级和服务类型**，可以**提高网络的服务质量**。  
④：总长度  
占16比特  
总长度 = 首部+数据的长度之和，最大65535

> 由于帧的数据不能超过1500字节，所以过大的IP数据包，需要分成片（fragments）传输给数据链路  
> 层。  
> 标识、标志、片偏移，它们用于处理数据包在传输过程中**可能被分片**的情况，**确保分片后的数据包能够正确重组**。

⑤：标识  
占16比特  
作用：唯一标识一个数据包。如果数据包被分片，所有分片的数据包具有相同的标识值，以便接收端能够识别哪些分片属于同一个原始数据包。（**简而言之：给数据包进行标记，让它们有身份的ID**）\[**会有专门的计数器管理标识，如果发出一个数据包就ID加1**\]

*   示例：
    
    *   发送端发送一个数据包时，为其分配一个唯一的标识值。
        
    *   如果数据包被**分片**，所有分片的数据包都会使用相同的标识值。
        

⑥：标志  
标志：**控制数据包的分片行为**（是否允许分片、是否还有更多分片）。  
占3比特

*   最低位（More Fragment，MF）
    *   MF=1表示本分片后面**还有分片**
    *   MF=0表示本分片后面**没有分片**
*   中间位（Don’t Fragment，DF）
    *   DF=1表示**不允许分片**
    *   DF=0表示**允许分片**
*   最高位为保留位，必须设置为0

⑦：片偏移  
片偏移：**表示分片在原始数据包中的位置**。  
占13比特  
片偏移乘以8：字节偏移  
每一片的长度一定是8的整数倍。  
⑧：生存时间（生存周期，TTL）  
占8比特

TTL 是 IPv4 数据包头部中的一个字段，用于限制数据包在网络中的最大存活时间或跳数。

它的主要作用是**防止数据包无限循环**，并可用于网络诊断和控制数据包传播范围。

**每经过一个路由器，TTL 值减 1，当 TTL 减到 0 时，数据包被丢弃，路由器会返回错误报告**。  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/a8fe3d2d11bf4d489407dbcfceb8a9d3.png)

⑨协议  
指明IPv4数据报的数据载荷是**何种协议数据单元PDU**。  
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/467c68f38def45719e4fd0000b148293.png)

⑩：首部校验和  
用于**检测数据包头部在传输过程中是否发生了错误**。  
⑪：可选字段  
使得 IPv4 协议更加灵活，能够**支持多种扩展功能**。  
⑫：填充  
使**用0填充**。  
当首部长度（固定部分+可变部分）不是**4的整数倍**时，才进行填充。

本文转自 <https://blog.csdn.net/2401_82911768/article/details/145800344?spm=1001.2014.3001.5502>，如有侵权，请联系删除。